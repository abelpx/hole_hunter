package handler

import (
	"context"

	"github.com/holehunter/holehunter/internal/models"
	"github.com/holehunter/holehunter/internal/svc"
)

// VulnerabilityHandler 漏洞处理器
type VulnerabilityHandler struct {
	service *svc.VulnerabilityService
}

// NewVulnerabilityHandler 创建漏洞处理器
func NewVulnerabilityHandler(service *svc.VulnerabilityService) *VulnerabilityHandler {
	return &VulnerabilityHandler{service: service}
}

// GetAll 获取所有漏洞
func (h *VulnerabilityHandler) GetAll(ctx context.Context) ([]*models.Vulnerability, error) {
	return h.service.GetAll(ctx)
}

// GetByTaskID 根据任务 ID 获取漏洞列表
func (h *VulnerabilityHandler) GetByTaskID(ctx context.Context, taskID int) ([]*models.Vulnerability, error) {
	return h.service.GetByTaskID(ctx, taskID)
}

// GetByID 根据 ID 获取漏洞
func (h *VulnerabilityHandler) GetByID(ctx context.Context, id int) (*models.Vulnerability, error) {
	return h.service.GetByID(ctx, id)
}

// MarkFalsePositive 标记误报
func (h *VulnerabilityHandler) MarkFalsePositive(ctx context.Context, id int, falsePositive bool) error {
	return h.service.MarkFalsePositive(ctx, id, falsePositive)
}

// UpdateNotes 更新备注
func (h *VulnerabilityHandler) UpdateNotes(ctx context.Context, id int, notes string) error {
	return h.service.UpdateNotes(ctx, id, notes)
}

// Delete 删除漏洞
func (h *VulnerabilityHandler) Delete(ctx context.Context, id int) error {
	return h.service.Delete(ctx, id)
}

// GetStats 获取漏洞统计
func (h *VulnerabilityHandler) GetStats(ctx context.Context) (*svc.VulnStats, error) {
	return h.service.GetStats(ctx)
}

// GetPage 获取分页漏洞
func (h *VulnerabilityHandler) GetPage(ctx context.Context, page, pageSize int) ([]*models.Vulnerability, int, error) {
	return h.service.GetPage(ctx, page, pageSize)
}

// GetPageByFilter 根据过滤条件获取分页漏洞
func (h *VulnerabilityHandler) GetPageByFilter(ctx context.Context, filter *models.VulnerabilityFilter, page, pageSize int) ([]*models.Vulnerability, int, error) {
	return h.service.GetPageByFilter(ctx, filter, page, pageSize)
}
